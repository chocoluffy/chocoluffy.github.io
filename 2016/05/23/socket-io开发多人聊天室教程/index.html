<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>socket.ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹ | One Piece</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="O92Q-a9Vf5dWXDW5Df-7NMxOta1TkJyuJddQxTM-n4U" />
  <meta name="description" content="ç”¨socket.ioæ­é…expresså†™çš„ä¸€ä¸ªå¤šäººèŠå¤©å®¤åº”ç”¨ï¼Œ åŒæ—¶å€Ÿè¿™ä¸ªæœºä¼šå¤ä¹ äº†ä¸€ä¸‹socketåŠTCP/IPçš„ä¸€äº›ç»†èŠ‚çŸ¥è¯†ï¼Œ åœ¨UIä¸Šç”¨jqueryï¼Œ ç®€æ´è€Œå¿«é€Ÿåœ°å®Œæˆä¸€äº›åŸºç¡€å‰ç«¯æ ·å¼çš„å¼€å‘ï¼Œ å¼€å‘æ—¶ç”¨nodemonå’Œbrowser-syncæ¥è¾…åŠ©å¼€å‘æµç¨‹ã€‚åœ¨çº¿Demo-ç½‘é¡µç‰ˆ, githubæºä»£ç , æ¬¢è¿æäº¤bug issueæˆ–è€…pull request~">
<meta property="og:type" content="article">
<meta property="og:title" content="socket.ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹">
<meta property="og:url" content="http://chocoluffy.com/2016/05/23/socket-ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹/index.html">
<meta property="og:site_name" content="One Piece">
<meta property="og:description" content="ç”¨socket.ioæ­é…expresså†™çš„ä¸€ä¸ªå¤šäººèŠå¤©å®¤åº”ç”¨ï¼Œ åŒæ—¶å€Ÿè¿™ä¸ªæœºä¼šå¤ä¹ äº†ä¸€ä¸‹socketåŠTCP/IPçš„ä¸€äº›ç»†èŠ‚çŸ¥è¯†ï¼Œ åœ¨UIä¸Šç”¨jqueryï¼Œ ç®€æ´è€Œå¿«é€Ÿåœ°å®Œæˆä¸€äº›åŸºç¡€å‰ç«¯æ ·å¼çš„å¼€å‘ï¼Œ å¼€å‘æ—¶ç”¨nodemonå’Œbrowser-syncæ¥è¾…åŠ©å¼€å‘æµç¨‹ã€‚åœ¨çº¿Demo-ç½‘é¡µç‰ˆ, githubæºä»£ç , æ¬¢è¿æäº¤bug issueæˆ–è€…pull request~">
<meta property="og:image" content="http://ac-TC2Vc5Tu.clouddn.com/1a5c1f59080e5cc1.png">
<meta property="og:image" content="http://ac-TC2Vc5Tu.clouddn.com/8d0dd106f5f226f4.png">
<meta property="og:image" content="http://ac-TC2Vc5Tu.clouddn.com/8b9309129959f85e.png">
<meta property="og:image" content="http://ac-TC2Vc5Tu.clouddn.com/4aa537ca52ea8080.png">
<meta property="og:updated_time" content="2016-05-24T03:25:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="socket.ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹">
<meta name="twitter:description" content="ç”¨socket.ioæ­é…expresså†™çš„ä¸€ä¸ªå¤šäººèŠå¤©å®¤åº”ç”¨ï¼Œ åŒæ—¶å€Ÿè¿™ä¸ªæœºä¼šå¤ä¹ äº†ä¸€ä¸‹socketåŠTCP/IPçš„ä¸€äº›ç»†èŠ‚çŸ¥è¯†ï¼Œ åœ¨UIä¸Šç”¨jqueryï¼Œ ç®€æ´è€Œå¿«é€Ÿåœ°å®Œæˆä¸€äº›åŸºç¡€å‰ç«¯æ ·å¼çš„å¼€å‘ï¼Œ å¼€å‘æ—¶ç”¨nodemonå’Œbrowser-syncæ¥è¾…åŠ©å¼€å‘æµç¨‹ã€‚åœ¨çº¿Demo-ç½‘é¡µç‰ˆ, githubæºä»£ç , æ¬¢è¿æäº¤bug issueæˆ–è€…pull request~">
  
    <link rel="alternative" href="/atom.xml" title="One Piece" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww3.sinaimg.cn/large/c5ee78b5gw1ez498sfwnuj208w08wmxt.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Shunzhe Yu</a></h1>
		</hgroup>

		
		<p class="header-subtitle">æŠ€æœ¯å°±æ˜¯ä¿¡ä»°</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ ‡ç­¾</li>
						
						
						<li>ç®€ä»‹</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
				        
							<li><a href="/tech">æŠ€æœ¯</a></li>
				        
							<li><a href="/life">éšç¬”</a></li>
				        
							<li><a href="/about">å…³äºæˆ‘</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/chocoluffy" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/chocoluffy" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100007218182748" title="facebook">facebook</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AWS/" style="font-size: 11px;">AWS</a> <a href="/tags/C/" style="font-size: 11px;">C</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 19px;">javascript</a> <a href="/tags/machine-learning/" style="font-size: 10px;">machine learning</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/rails/" style="font-size: 13px;">rails</a> <a href="/tags/web-design/" style="font-size: 16px;">web design</a> <a href="/tags/ä¼¯å…‹åˆ©äº¤æ¢/" style="font-size: 10px;">ä¼¯å…‹åˆ©äº¤æ¢</a> <a href="/tags/å…¬ä¼—å·æ–‡ç« /" style="font-size: 20px;">å…¬ä¼—å·æ–‡ç« </a> <a href="/tags/åˆ›ä¸š/" style="font-size: 12px;">åˆ›ä¸š</a> <a href="/tags/å•†ä¸šITè¯„è®º/" style="font-size: 10px;">å•†ä¸šITè¯„è®º</a> <a href="/tags/å•†ä¸šè¯„è®º/" style="font-size: 14px;">å•†ä¸šè¯„è®º</a> <a href="/tags/æ”¶è—å¸–/" style="font-size: 10px;">æ”¶è—å¸–</a> <a href="/tags/æ—¥è®°/" style="font-size: 16px;">æ—¥è®°</a> <a href="/tags/ç¤¾ä¼šäººç‰©/" style="font-size: 17px;">ç¤¾ä¼šäººç‰©</a> <a href="/tags/è™šæ‹Ÿç°å®/" style="font-size: 10px;">è™šæ‹Ÿç°å®</a> <a href="/tags/è¯»ä¹¦ç¬”è®°/" style="font-size: 18px;">è¯»ä¹¦ç¬”è®°</a> <a href="/tags/è¾©è®ºè®°å½•/" style="font-size: 10px;">è¾©è®ºè®°å½•</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">
						<p>å¤šä¼¦å¤šå¤§å­¦è®¡ç®—æœºç³»</p>
					</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Shunzhe Yu</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://ww3.sinaimg.cn/large/c5ee78b5gw1ez498sfwnuj208w08wmxt.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Shunzhe Yu</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
					<li><a href="/tech">æŠ€æœ¯</a></li>
		        
					<li><a href="/life">éšç¬”</a></li>
		        
					<li><a href="/about">å…³äºæˆ‘</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/chocoluffy" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/chocoluffy" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100007218182748" title="facebook">facebook</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-socket-ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/23/socket-ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹/" class="article-date">
  	<time datetime="2016-05-24T02:43:41.000Z" itemprop="datePublished">2016-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      socket.ioå¼€å‘å¤šäººèŠå¤©å®¤æ•™ç¨‹
    </h1>
  


      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-design/">web design</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/æŠ€æœ¯/">æŠ€æœ¯</a>
	</div>



        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ç”¨socket.ioæ­é…expresså†™çš„ä¸€ä¸ªå¤šäººèŠå¤©å®¤åº”ç”¨ï¼Œ åŒæ—¶å€Ÿè¿™ä¸ªæœºä¼šå¤ä¹ äº†ä¸€ä¸‹socketåŠTCP/IPçš„ä¸€äº›ç»†èŠ‚çŸ¥è¯†ï¼Œ åœ¨UIä¸Šç”¨jqueryï¼Œ ç®€æ´è€Œå¿«é€Ÿåœ°å®Œæˆä¸€äº›åŸºç¡€å‰ç«¯æ ·å¼çš„å¼€å‘ï¼Œ å¼€å‘æ—¶ç”¨nodemonå’Œbrowser-syncæ¥è¾…åŠ©å¼€å‘æµç¨‹ã€‚<a href="http://chatroom.sb6imr3gpx.us-west-2.elasticbeanstalk.com/" target="_blank" rel="external">åœ¨çº¿Demo-ç½‘é¡µç‰ˆ</a>, <a href="https://github.com/chocoluffy/chatroom" target="_blank" rel="external">githubæºä»£ç </a>, æ¬¢è¿æäº¤bug issueæˆ–è€…pull request~</p>
<a id="more"></a>
<p><img src="http://ac-TC2Vc5Tu.clouddn.com/1a5c1f59080e5cc1.png" alt="socket.io"></p>
<h2 id="ä»€ä¹ˆæ˜¯socket?">ä»€ä¹ˆæ˜¯socket?</h2><p>socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼Œ æœ¬èº«æ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„APIï¼Œ ç”¨socketå¯ä»¥è®©ç¨‹åºå‘˜æ›´æ–¹ä¾¿çš„ä½¿ç”¨TCP/IPåè®®è€Œå·²ã€‚ </p>
<p>åœ¨å­¦ä¹ Cè¯­è¨€(csc209)çš„æ—¶å€™å¤§å®¶æ¥è§¦åˆ°çš„socketçš„æ¥å£å‡½æ•°æ¯”å¦‚<code>create/listen/connect/accept/send/read/write</code>ï¼Œ å®é™…ä¸Šæ­£æ˜¯é’ˆå¯¹TCPç¼–ç¨‹çš„æ¥å£ï¼Œ åœ¨è¯¾ç¨‹é‡Œæˆ‘ä»¬ç”¨Cè¯­è¨€æ¥å®ç°TCPæœ€åŸºç¡€çš„ä¸€ä¸ªsocketé“¾æ¥ï¼Œ ç›‘å¬ï¼Œ åŒ…æ‹¬server-clientä¹‹é—´çš„é€šä¿¡ï¼ŒåŒæ ·çš„ï¼Œ socketè¿™ä¸ªè°ƒç”¨æ¥å£ä¹Ÿå¯ä»¥ç”¨java, pythonå’Œnodejsä»»ä½•åç«¯è¯­è¨€æ¥å®ç°ï¼Œ ä¹Ÿä¼šå‡ºç°åœ¨å„ç§å„æ ·éœ€è¦æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯é€šä¿¡çš„åº”ç”¨ä¸­ã€‚</p>
<p>è€Œä»€ä¹ˆæ˜¯TCPå‘¢ï¼Ÿ</p>
<p>Transmission Control Protocol (TCP) å°±æ˜¯å…¶ä¸­å‘é€æ–‡æœ¬ä¿¡æ¯çš„<strong>è§„åˆ™è§„èŒƒ</strong>è€Œå·²ã€‚ TCPä¾èµ–æ›´åº•å±‚çš„å‡½æ•°å®ç°æ¥åœ¨ç½‘ç»œä¸Šä¼ è¾“binary dataã€‚ è¿™é‡Œå’Œå¤§å®¶ä»‹ç»telnet\puttyè¿™äº›åˆ©ç”¨TCPåœ¨command lineä¸Šå¸®åŠ©ä½ å‘é€å’Œæ¥å—çº¯æ–‡æœ¬æ¶ˆæ¯çš„åº”ç”¨ï¼Œ ä½ å¯ä»¥åˆ©ç”¨telnetæ¥ï¼Œ æ¯”å¦‚ï¼Œ å‘é€æ¶ˆæ¯åˆ°google.comï¼š<code>telnet google.com 80</code> åœ¨ç«¯å£80è¿æ¥åˆ°google.com(80é»˜è®¤ç»™ç½‘ç»œè¯·æ±‚)ã€‚æˆ‘ä»¬å½“ç„¶ä¸ä¼šéšä¾¿å‘æ–‡æœ¬æ¶ˆæ¯ç»™google.comï¼Œ å› ä¸ºæˆ‘ä»¬çŸ¥é“google.comä¸ä¼šæ¥å—éšæ„çš„ï¼Œ æ²¡æœ‰ç»“æ„çš„æ–‡æœ¬è¯·æ±‚ã€‚ æ˜¯çš„ï¼Œ æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>æ ‡å‡†(protocol)</strong>æ¥è§„èŒƒäº¤æµçš„æ–¹å¼ã€‚æˆ‘ä»¬åœ¨æµè§ˆå™¨è¾“å‡º<a href="http://google.comï¼Œ" target="_blank" rel="external">http://google.comï¼Œ</a> è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>åœ¨port 80ç”¨TCPåè®®è¿æ¥google.comçš„æœåŠ¡å™¨ã€‚</li>
<li>è¯·æ±‚è¿”å›èµ„æºâ€œï¼â€ï¼ˆé»˜è®¤èµ„æºï¼‰ã€‚</li>
<li>å°†è¯·æ±‚ç”¨httpï¼ˆhypertext transfer protocolï¼‰çš„å½¢å¼æ¥è§„èŒƒã€‚</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯socket-io?">ä»€ä¹ˆæ˜¯socket.io?</h2><p>â€œSocket.IO goes a step beyond just providing an easy-to-use and more robust API on top<br>of web sockets. It also provides the ability to seamlessly use other real-time protocols if WebSockets are not available. For example, it will fall back on JSON long polling in the absence of WebSocket support.â€ from Rohit Rai</p>
<p>ç®€å•æ¥è¯´ï¼Œsocket.ioæ¥socketæœ¬èº«çš„æ¥å£å‡½æ•°ä¸Šå†æŠ½è±¡äº†ä¸€å±‚ï¼Œ è®©ç¨‹åºå‘˜å¯ä»¥ä¸“æ³¨åº”ç”¨é€»è¾‘çš„å¼€å‘ï¼Œ è€Œç”±socket.ioæ¥æ“ä½œåº•å±‚çš„å‡½æ•°è°ƒç”¨å’Œä¼˜åŒ–ï¼Œ æ¯”å¦‚æœ‰äº›æ—¶å€™ï¼Œ ç”±äºæµè§ˆå™¨çš„åŸå› ä¸èƒ½ä½¿ç”¨web socketæ—¶ï¼Œ å¯ä»¥é»˜è®¤ç”¨long pollingæ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚</p>
<p>åœ¨socket.ioå‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨å¾ˆå¤šçš„hackæ¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š<strong>æ€æ ·åœ¨serverå’Œclientç«¯æ›´æœ‰æ•ˆç‡åœ°åŒå‘ä¼ é€’ä¿¡æ¯ï¼Ÿ</strong>æ¯”å¦‚ä¸Šæ–‡æåˆ°çš„long polling,  clientç«¯å‘é€XHRè¯·æ±‚ï¼Œ ç„¶ååœ¨serverç«¯æŒ‚ä½ï¼Œ ç›´åˆ°serveræ”¶åˆ°æ•°æ®ï¼Œ å°±å›ä¼ æ•°æ®ï¼Œ è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„hackã€‚</p>
<p>ç›´åˆ°HTML5çš„å¤§è§„æ¨¡ä½¿ç”¨ï¼Œ å‡ºç°äº†ä¸¤ç§ä»æœåŠ¡å™¨ç«¯æ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯çš„æ–°æ–¹æ³•ï¼Œ ä¸€ä¸ªæ˜¯Server-Sent Events (SSE)ï¼Œ å¦ä¸€ä¸ªæ˜¯ä»Šå¤©çš„ä¸»è§’ï¼Œ æ”¯æŒåŒå‘é€šä¿¡çš„WebSockets.</p>
<h2 id="æ€ä¹ˆç”¨socket-io?">æ€ä¹ˆç”¨socket.io?</h2><p>ä¸‹é¢ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜socketçš„ä½¿ç”¨ï¼Œ å¾ˆæ˜ç¡®ï¼Œ åœ¨æœåŠ¡å™¨æ®µå½“æœ‰æ–°çš„è¿æ¥çš„æ—¶å€™ï¼Œ å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªâ€greeting-from-serverâ€çš„æ¶ˆæ¯ï¼Œ åŒæ—¶è¿˜ç›‘å¬å®¢æˆ·ç«¯å‘æ¥çš„â€greeting-from-clientâ€çš„äº‹ä»¶ï¼Œå°†æ¶ˆæ¯æ‰“å°åœ¨consoleé‡Œé¢ã€‚ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plain http's version of server.js</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">	socketIO = <span class="built_in">require</span>(<span class="string">'socket.io'</span>);</span><br><span class="line">	fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// if using express framework, we can define router easier!</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	fs.readFile(__dirname + <span class="string">'/index.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">		res.writeHead(<span class="number">200</span>);</span><br><span class="line">		res.end(data);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The above code is used for create a server to serve the static index.html file under the current directory. The following part is the main idea of how to use socket.io to construct and listen to events.</span></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'listen on http://localhost:3000'</span>);</span><br><span class="line"></span><br><span class="line">io = socketIO(server);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line">	socket.emit(<span class="string">'greeting-from-server'</span>, &#123;</span><br><span class="line">		greeting: <span class="string">'Hello client!'</span></span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	socket.on(<span class="string">'greeting-from-client'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(msg);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- client side index.html  --&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/socket.io/socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">            <span class="keyword">var</span> socket = io(<span class="string">'http://localhost:3000'</span>);</span><br><span class="line">            socket.on(<span class="string">'greeting-from-server'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.body.appendChild(</span><br><span class="line">                    <span class="built_in">document</span>.createTextNode(message.greeting)</span><br><span class="line">                );</span><br><span class="line">                socket.emit(<span class="string">'greeting-from-client'</span>, &#123;</span><br><span class="line">                    greeting: <span class="string">'Hello Server'</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å¾ˆç®€æ´ã€‚ä»¥ä¸Šæ˜¯ç”¨nodeåŸç”Ÿçš„httpæ¨¡å—æ¥æ­å»ºçš„æœ¬åœ°æœåŠ¡å™¨ï¼Œ è¿˜å¯ä»¥å°è¯•ä½¿ç”¨expressè¿™ä¸ªæœ€è´Ÿç››åçš„nodeæ¡†æ¶ä¹‹ä¸€æ¥é‡æ–°å®ç°ä¸€ä¸‹ç›¸åŒçš„é€»è¾‘ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express's version of server.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),</span><br><span class="line">    app = express(),</span><br><span class="line">    http = <span class="built_in">require</span>(<span class="string">'http'</span>),</span><br><span class="line">    socketIO = <span class="built_in">require</span>(<span class="string">'socket.io'</span>),</span><br><span class="line">    server, io;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.sendFile(__dirname + <span class="string">'/index.html'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server = http.Server(app);</span><br><span class="line">server.listen(<span class="number">5000</span>);</span><br><span class="line">io = socketIO(server);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  socket.emit(<span class="string">'greeting-from-server'</span>, &#123;</span><br><span class="line">      greeting: <span class="string">'Hello Client'</span></span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  socket.on(<span class="string">'greeting-from-client'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(message);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Express is a collection of HTTP utilities and middleware that make it easier to use Node as a web server.</p>
</blockquote>
<p>ç”¨<code>var app = express()</code>æ¥åˆ›å»ºä¸€ä¸ªExpressåº”ç”¨ï¼Œå°†è¿™ä¸ªExpress appå½“ä½œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥HTTPæ¨¡å—å¾—åˆ°æœ¬åœ°çš„ç®€æ˜“æœåŠ¡å™¨ï¼Œwe told Node that we wanted to use Express as our handler for HTTP requests. è€Œè¿™ä¸ªæœåŠ¡å™¨çš„ä½œç”¨æ˜¯åœ¨æ¥æ”¶åˆ°å¯¹â€œï¼â€é»˜è®¤èµ„æºçš„è¯·æ±‚æ—¶ï¼Œ å°†index.htmlæ–‡ä»¶ä¼ å›ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨ä¸Šæ˜¾ç¤ºå‡ºå†…å®¹ã€‚</p>
<p>Next, we passed the HTTP server directly to the SocketIO method exactly as we would have if we were using a nonExpress HTTP server. Socket.IO took the server instance to listen for new socket connections on it. </p>
<p>å…¶ä¸­ä¸€ä¸ªå°ç»†èŠ‚ï¼šç”¨ <code>emit</code> æ¥ä¼ è¾“named message, ç”¨ <code>send</code> æ¥ä¼ è¾“a message without name.</p>
<h2 id="å¤šäººåœ¨çº¿èŠå¤©å®¤">å¤šäººåœ¨çº¿èŠå¤©å®¤</h2><p>ä¸‹é¢æ˜¯å¯¹ä»¥ä¸Šåº”ç”¨çš„ä¸€ä¸ªç®€å•æ‹“å±•ã€‚ä½¿ç”¨ä¸€ä¸ªè½®æ’­(broadcasting)çš„æ–¹å¼ï¼Œ å°†å®¢æˆ·ç«¯ä¼ æ¥çš„æ¶ˆæ¯æ˜¾ç¤ºç»™æ¯ä¸€ä¸ªåœ¨çº¿çš„ç”¨æˆ·ã€‚</p>
<p><a href="https://github.com/chocoluffy/chatroom" target="_blank" rel="external">githubæºä»£ç     </a></p>
<p><a href="http://chatroom.sb6imr3gpx.us-west-2.elasticbeanstalk.com/" target="_blank" rel="external">åœ¨çº¿Demo-ç½‘é¡µç‰ˆ</a></p>
<p>åœ¨æ‰‹æœºä¸Šä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œ ä¸è¿‡UIæ²¡æœ‰ä¸“é—¨é’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼Œ ä¼šæœ‰ç‚¹ç³—çš„æ„Ÿè§‰ğŸ˜­ã€‚æœ‰bugæ±‡æŠ¥åˆ°Issueå‘€ï¼Œ è°¢è°¢~</p>
<p>æ•ˆæœå›¾Demo:</p>
<p>[1] pick a nickname:<br><img src="http://ac-TC2Vc5Tu.clouddn.com/8d0dd106f5f226f4.png" alt="demo-nickname"></p>
<p>[2] chatroom initialization:<br><img src="http://ac-TC2Vc5Tu.clouddn.com/8b9309129959f85e.png" alt="demo-init"></p>
<p>[3] multi users chatting(one in chrome, another in safari):<br><img src="http://ac-TC2Vc5Tu.clouddn.com/4aa537ca52ea8080.png" alt="demo-multusers"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A fragment of server.js</span></span><br><span class="line"><span class="keyword">var</span> port = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line">server.listen(port);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'listen on '</span> + port);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> io = socketIO(server);</span><br><span class="line"><span class="keyword">var</span> sockets = [];</span><br><span class="line"><span class="keyword">var</span> ID2user = &#123;&#125;; <span class="comment">// username </span></span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line">	sockets.push(socket);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> updateUserNum = <span class="function"><span class="keyword">function</span>(<span class="params">skt</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> people = sockets.length === <span class="number">1</span> ? <span class="string">'person'</span> : <span class="string">'people'</span>;</span><br><span class="line">		skt.emit(<span class="string">'greeting-from-server'</span>, &#123;</span><br><span class="line">			greeting: <span class="string">'Welcome! '</span> + sockets.length + <span class="string">' '</span> + people + <span class="string">' online now!'</span></span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	updateUserNum(socket);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// boardcast?!</span></span><br><span class="line">	socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> userlistChanged = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span>(!ID2user[socket.id])&#123; <span class="comment">// if new user comes in.</span></span><br><span class="line">			<span class="keyword">var</span> profile = &#123;</span><br><span class="line">				username: message.username,</span><br><span class="line">				avatar: message.avatar</span><br><span class="line">			&#125;;</span><br><span class="line">			ID2user[socket.id] = profile;</span><br><span class="line">			userlistChanged = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; sockets.length; i++)&#123;</span><br><span class="line">			sockets[i].emit(<span class="string">'message'</span>, message);</span><br><span class="line">			<span class="keyword">if</span>(userlistChanged)&#123; <span class="comment">// update userlist when new user comes in.</span></span><br><span class="line">				<span class="built_in">console</span>.log(ID2user[socket.id].username + <span class="string">'(id: '</span> + socket.id + <span class="string">' )'</span> + <span class="string">'joins!'</span>);</span><br><span class="line">				sockets[i].emit(<span class="string">'userlist'</span>, ID2user);</span><br><span class="line">				updateUserNum(sockets[i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;sockets.length; i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(sockets[i].id === socket.id)&#123;</span><br><span class="line">				sockets.splice(i, <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> usernameOut = ID2user[socket.id].username;</span><br><span class="line">		<span class="keyword">delete</span> ID2user[socket.id]; <span class="comment">// remove user from online users.</span></span><br><span class="line">		<span class="comment">// send to client an updated userlist.</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; sockets.length; i++)&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(usernameOut + <span class="string">'(id: '</span> + socket.id + <span class="string">' )'</span> + <span class="string">'leaves...'</span>);</span><br><span class="line">			sockets[i].emit(<span class="string">'userlist'</span>, ID2user);</span><br><span class="line">			updateUserNum(sockets[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"There are "</span> + sockets.length + <span class="string">" active sockets remaining."</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªåº”ç”¨æ”¾åœ¨æœåŠ¡å™¨ä¸Šçœ‹æ•ˆæœï¼Œ æ‰€ä»¥port numberå°±ä¸èƒ½ä¸€ç›´æ˜¯æœ¬åœ°çš„localhostäº†ï¼Œ éœ€è¦æ”¹æˆ<code>var port = process.env.PORT || 3000;</code>ã€‚</p>
<p>è¾¾åˆ°çš„æ•ˆæœï¼š</p>
<ul>
<li>æ˜¾ç¤ºåŒæ—¶åœ¨çº¿çš„äººæ•°å’Œuser listã€‚æ ¹æ®ä½ è‡ªå·±é€‰çš„nicknameåœ¨user listä¸Šæ˜¾ç¤ºã€‚</li>
<li>æ¯å½“æœ‰äººåŠ å…¥æˆ–è€…disconnectçš„æ—¶å€™ï¼Œæ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„user listã€‚åŒæ—¶consoleéƒ½ä¼šæœ‰è®°å½•ã€‚</li>
<li>æ¯å½“æœ‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œ broadcastingç»™æ‰€æœ‰åœ¨çº¿ç”¨æˆ·ã€‚</li>
</ul>
<p>TODOsï¼š</p>
<ul>
<li>local cache most frequent online users, to make the message transfer much much more efficient and effective. </li>
<li>support image transfer, which should be quite similar to text message, but rather using binary image data. </li>
<li>introduce animation!! this part should be quite familiar to me but Iâ€™s just being lazyâ€¦â€¦</li>
<li>social media ;)</li>
</ul>
<p>ä¸‹é¢æ˜¯éƒ¨åˆ†clientç«¯çš„ä»£ç ï¼šç”±äºç›‘å¬äº†ä¸€äº›äº‹ä»¶ï¼ˆæ¯•ç«Ÿæˆ‘è¿˜æ˜¯è°ƒæ•´äº†å‰ç«¯çš„ğŸ˜‚ï¼‰, æ‰€ä»¥ä»£ç æœ‰ç‚¹é•¿ï¼Œ ä¸‹é¢åªæ˜¾ç¤ºæ ¸å¿ƒéƒ¨åˆ†ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">// part of index.html's script</span><br><span class="line">var socket = io();</span><br><span class="line">socket.on('connect', function()&#123;</span><br><span class="line"></span><br><span class="line">    // ... some codes here ...</span><br><span class="line"></span><br><span class="line">	socket.on('greeting-from-server', function(msg)&#123;</span><br><span class="line">		$('#greeting').empty();</span><br><span class="line">		$('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').addClass('headline').text(msg.greeting).appendTo($('#greeting'));</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">    // MAIN IDEA: if message comes, append to right place, and self adjust the view!</span><br><span class="line">	socket.on('message', function(msg)&#123;</span><br><span class="line"></span><br><span class="line">		var container = $('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').attr('id', 'container');</span><br><span class="line">		var bubble = $('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').addClass('talk-bubble tri-right left-in border');</span><br><span class="line">		var textWrapper = $('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').addClass('talktext').appendTo(bubble);</span><br><span class="line">		$('<span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>').html(msg.messageText).appendTo(textWrapper);</span><br><span class="line"></span><br><span class="line">		// append the jquery clone to target destination.</span><br><span class="line">		var nameClone = username2jqy(msg.username);</span><br><span class="line">		var avaClone = avatar2jqy(msg.avatar);</span><br><span class="line"></span><br><span class="line">		avaClone.appendTo(container);</span><br><span class="line">		nameClone.appendTo(container);</span><br><span class="line">		bubble.clone().appendTo(container);</span><br><span class="line">		container.clone().appendTo($('#messages'));</span><br><span class="line"></span><br><span class="line">		$('<span class="tag">&lt;<span class="title">br</span>&gt;</span>').appendTo($('#messages'));</span><br><span class="line"></span><br><span class="line">		// self-adjust scrolling height.</span><br><span class="line">		var msgWrapper = document.getElementById('messages');</span><br><span class="line">		msgWrapper.scrollTop = msgWrapper.scrollHeight;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">    // MAIN IDEA: when user list need to update, do it!</span><br><span class="line">	socket.on('userlist', function(userlist)&#123;</span><br><span class="line">		$('#userlist').empty();</span><br><span class="line">		$('<span class="tag">&lt;<span class="title">h2</span>&gt;</span><span class="tag">&lt;/<span class="title">h2</span>&gt;</span>').text('Online users:').appendTo($('#userlist'));</span><br><span class="line">		Object.keys(userlist).map(function(d)&#123;</span><br><span class="line">			var usrImg = $('<span class="tag">&lt;<span class="title">img</span>&gt;</span><span class="tag">&lt;/<span class="title">img</span>&gt;</span>').attr('src', userlist[d].avatar);</span><br><span class="line">			var usrName = $('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').text(userlist[d].username).addClass('listname');</span><br><span class="line">			var profileWrapper = $('<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>').addClass('userlistProfile');</span><br><span class="line">			usrImg.appendTo(profileWrapper);</span><br><span class="line">			usrName.appendTo(profileWrapper);</span><br><span class="line">			profileWrapper.appendTo($('#userlist'));</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="èƒŒæ™¯çŸ¥è¯†è¡¥å……">èƒŒæ™¯çŸ¥è¯†è¡¥å……</h2><p>å®Œæˆä¸€ä¸ªå°demoçš„å¼€å‘åŒæ ·ä¼šéœ€è¦å¾ˆå¤šè¾¹è§’æ–™ä¿¡æ¯çš„è¡¥å……ï¼Œ æ²¡æœ‰äººä¼šè®°å¾—æ‰€æœ‰javascriptå„ç§å¤„ç†å¯¹è±¡çš„å‡½æ•°ï¼Œ ä¹Ÿæ²¡æœ‰äººéœ€è¦è®°å¾—ã€‚ç•™ä¸ªnoteç»™è‡ªå·±ï¼Œ ä¹Ÿå†ä»¥åæŸ¥çº çš„ä¹‹åæ–¹ä¾¿å›å¿†ã€‚</p>
<ul>
<li><a href="http://betterexplained.com/articles/a-simple-introduction-to-computer-networking/" target="_blank" rel="external">A Simple Introduction To Computer Networking</a></li>
<li><code>array.splice(i, 1);</code> will remove one item from ith index in that array, namely, in this case, remove the ith item from array.</li>
<li><code>docuemnt.createTextNode(string) \ document.createElement(&#39;div&#39;); \  document.getElementById(&#39;SOMEID&#39;).appendChild(element);</code> are some common DOM objects munipulations example.</li>
<li>refer to this post: <a href="http://stackoverflow.com/questions/8894226/javascript-submit-textbox-on-enter" target="_blank" rel="external">send message by pressing enter</a>, by adding an eventlistener function to message-box, we listent on the keyCode we press, if it is 13(Enter key), then we trigger the message send function.</li>
<li>refer to this post: <a href="http://codepen.io/Founts/pen/gmhcl" target="_blank" rel="external">styling for chat bubble</a></li>
<li>Know how to create DOM elements in jquery: <code>$(&#39;&lt;div&gt;&lt;/div&gt;&#39;).addClass(&#39;headline&#39;).html(msg).appendTo($(&#39;#greeting&#39;));</code></li>
<li>create modal in a visually good-looking way, refer to this post: <a href="https://github.com/kylefox/jquery-modal" target="_blank" rel="external">jquery.modal.js</a></li>
<li>add user a good-looking avatar! <a href="https://github.com/adorableio/avatars-api" target="_blank" rel="external">adorable avatar!</a></li>
<li>change html input focus, refer to this post: <a href="https://api.jquery.com/focus/" target="_blank" rel="external">html input focus</a></li>
<li>auto-adjust the scrolling top to the latest message, refer to this post: <a href="http://stackoverflow.com/questions/15432691/css-overflow-value-for-chat" target="_blank" rel="external">srollTop = scrollHeight</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/05/15/å‰ç«¯å¼€å‘å·¥å…·åº“-ç¬¬ä¸€æœŸ-npm-script/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">å‰ç«¯å¼€å‘å·¥å…·åº“[ç¬¬ä¸€æœŸ]-npm script</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">åˆ†äº«åˆ°: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>




<div class="share_addthis">
  <div class="sharing addthis_toolbox share">
    <a class="addthis_button_facebook_like"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-560c64c35486b3d4" async="async"></script>
</div>






<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'chocoluffy'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Shunzhe Yu
    		<span id="busuanzi_container_site_pv">
    			ä½ æ˜¯ç¬¬<span id="busuanzi_value_site_pv"></span>ä¸ªå°ä¼™ä¼´
			</span>
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41207871-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>