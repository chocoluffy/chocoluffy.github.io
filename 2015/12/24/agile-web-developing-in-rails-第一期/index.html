<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Agile web developing in rails ç¬¬ä¸€æœŸ | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ç›®çš„ï¼š å°†agile rails web applicationä¸€ä¹¦é‡Œé¢çš„ç²¾åæ¦‚æ‹¬ä¸‹æ¥ï¼Œ ä¸ºä¹‹åè¿ç”¨railså¼€å‘æ‰“åŸºç¡€">
<meta property="og:type" content="article">
<meta property="og:title" content="Agile web developing in rails ç¬¬ä¸€æœŸ">
<meta property="og:url" content="http://yoursite.com/2015/12/24/agile-web-developing-in-rails-ç¬¬ä¸€æœŸ/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ç›®çš„ï¼š å°†agile rails web applicationä¸€ä¹¦é‡Œé¢çš„ç²¾åæ¦‚æ‹¬ä¸‹æ¥ï¼Œ ä¸ºä¹‹åè¿ç”¨railså¼€å‘æ‰“åŸºç¡€">
<meta property="og:updated_time" content="2015-12-25T01:22:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Agile web developing in rails ç¬¬ä¸€æœŸ">
<meta name="twitter:description" content="ç›®çš„ï¼š å°†agile rails web applicationä¸€ä¹¦é‡Œé¢çš„ç²¾åæ¦‚æ‹¬ä¸‹æ¥ï¼Œ ä¸ºä¹‹åè¿ç”¨railså¼€å‘æ‰“åŸºç¡€">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww3.sinaimg.cn/large/c5ee78b5gw1ez498sfwnuj208w08wmxt.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Shunzhe Yu</a></h1>
		</hgroup>

		
		<p class="header-subtitle">æŠ€æœ¯å°±æ˜¯ä¿¡ä»°</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ ‡ç­¾</li>
						
						
						<li>å…³äºæˆ‘</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/chocoluffy" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/chocoluffy" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:luffy.yu@mail.utoronto.ca" title="mail">mail</a>
					        
								<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100007218182748" title="facebook">facebook</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/rails/" style="font-size: 13.33px;">rails</a> <a href="/tags/ä¼¯å…‹åˆ©äº¤æ¢/" style="font-size: 10px;">ä¼¯å…‹åˆ©äº¤æ¢</a> <a href="/tags/å…¬ä¼—å·æ–‡ç« /" style="font-size: 20px;">å…¬ä¼—å·æ–‡ç« </a> <a href="/tags/å•†ä¸šITè¯„è®º/" style="font-size: 13.33px;">å•†ä¸šITè¯„è®º</a> <a href="/tags/æ—¥è®°/" style="font-size: 10px;">æ—¥è®°</a> <a href="/tags/ç¤¾ä¼šäººç‰©/" style="font-size: 16.67px;">ç¤¾ä¼šäººç‰©</a> <a href="/tags/è¯»ä¹¦ç¬”è®°/" style="font-size: 16.67px;">è¯»ä¹¦ç¬”è®°</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">
						<p>å¤šä¼¦å¤šå¤§å­¦è®¡ç®—æœºç³», å–œæ¬¢æ€è€ƒã€‚</p>
						<a href="https://drive.google.com/open?id=0B6qSwdwPxPRddWFabS1iOWRzZlU">ğŸ’£æˆ‘çš„ç®€å†</a>
					</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Shunzhe Yu</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://ww3.sinaimg.cn/large/c5ee78b5gw1ez498sfwnuj208w08wmxt.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Shunzhe Yu</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/chocoluffy" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/chocoluffy" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:luffy.yu@mail.utoronto.ca" title="mail">mail</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100007218182748" title="facebook">facebook</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-agile-web-developing-in-rails-ç¬¬ä¸€æœŸ" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/24/agile-web-developing-in-rails-ç¬¬ä¸€æœŸ/" class="article-date">
  	<time datetime="2015-12-24T16:55:00.000Z" itemprop="datePublished">2015-12-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Agile web developing in rails ç¬¬ä¸€æœŸ
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/æŠ€æœ¯/">æŠ€æœ¯</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ç›®çš„ï¼š å°†agile rails web applicationä¸€ä¹¦é‡Œé¢çš„ç²¾åæ¦‚æ‹¬ä¸‹æ¥ï¼Œ ä¸ºä¹‹åè¿ç”¨railså¼€å‘æ‰“åŸºç¡€</p>
<a id="more"></a> 
<p>1\åœ¨cssé‡Œé¢é‡åˆ°å°†imageæŒ‰æ¯”ä¾‹ç¼©å°çš„æ—¶å€™ï¼Œ ä½¿ç”¨autoæ¥å¯¹width, heightæŒ‰æ¯”ä¾‹ç¼©å°<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.resize</span> <span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">70px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">height</span>:<span class="value"> auto</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>2\ä¸€äº›å®ç”¨çš„built-in rails features ä¾‹å¦‚ï¼š cycle\truncate\strip-tags<br>&lt;%= truncate(strip-tags(product.description), length: 100) % &gt;</p>
<p>3\rake db:rollback å°†æ•°æ®åº“å¾€å‰æ¢å¤ï¼Œ å¦‚æœæ˜¯éœ€è¦æ›´æ–°ï¼š<br>rake db:migrate, ä¹‹åå†å°†seedçš„æ•°æ®åŠ è½½è¿›æ¥, rake db:seed</p>
<p>4\åœ¨modeléƒ¨åˆ†è¿›è¡Œmodelsä¹‹é—´å…³ç³»çš„å®šä¹‰å’Œvalidationï¼š<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validates <span class="symbol">:title</span>, <span class="symbol">:description</span>, <span class="symbol">:image_url</span>, <span class="symbol">presence:</span> <span class="keyword">true</span></span><br></pre></td></tr></table></figure></p>
<p>é™¤äº†presenceè¿™ä¸ªæ–¹æ³•ä»¥å¤–ï¼Œ å¸¸ç”¨çš„è¿˜æœ‰:<br>inclusion: %w{male female} \length: {maximum: 30}\numericaliry: {greater_than_or_equal_to: 0.01}\format: {with: //}\<br>uniqueness: true\</p>
<p>ä¾‹å¦‚ï¼šæ£€æŸ¥image_urlæ˜¯å¦åˆæ³•ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">validates :</span>image_url, <span class="string">allow_blank:</span> <span class="literal">true</span>, <span class="string">format:</span> &#123;</span><br><span class="line"><span class="label">	with:</span> %r&#123;\.(gif|jpg|jpeg|png)\Z&#125;i,</span><br><span class="line"><span class="label">	message:</span> <span class="string">"must be a url for GIF, JPG, JPEG or PNG image."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5\controller test/unit test</p>
<p>assert_not_nil assigns(:person) ç¡®ä¿instance variables assigned in action is available for the view template, åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ<br>ç¡®ä¿@personè¿™ä¸ªinstance variableè¢«æˆåŠŸèµ‹å€¼</p>
<p>é‡ç‚¹ï¼š åœ¨testè¿™ä¸ªéƒ¨åˆ†ï¼Œ æˆ‘ä»¬ä½¿ç”¨get\post\patch\put\delete\headè¿™äº›æ–¹æ³•æ¥æ¨¡æ‹Ÿhttpè¯·æ±‚ï¼›ç„¶åç¬¬äºŒæ­¥ï¼Œ æˆ‘ä»¬assert statesæ˜¯å¦as expected,<br>è¿™é‡Œçš„state, æŒ‡çš„æ˜¯http state, or database date;<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test <span class="string">"should get index"</span> <span class="keyword">do</span></span><br><span class="line">  get <span class="symbol">:index</span></span><br><span class="line">  <span class="comment"># è°ƒç”¨product controlleré‡Œé¢çš„indexæ–¹æ³•</span></span><br><span class="line">  assert_response <span class="symbol">:success</span></span><br><span class="line">  <span class="comment"># make sure that the request is successful</span></span><br><span class="line">  assert_not_nil assigns(<span class="symbol">:products</span>)</span><br><span class="line">  <span class="comment"># assignsæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ£€æŸ¥<span class="doctag">@product</span>è¿™ä¸ªinstance variableæ˜¯å¦è¢«æˆåŠŸèµ‹å€¼</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„getå¯ä»¥æ¥å—4ä¸ªå‚æ•°ï¼Œ ç¬¬ä¸€ä¸ªæ˜¯controller actionçš„åå­—ï¼Œ å¯ä»¥ä¸ºsymbol\string; ç¬¬äºŒä¸ªå‚æ•°ï¼š an optional hash to pass into the action<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">test <span class="string">"should create article"</span> <span class="keyword">do</span></span><br><span class="line">  assert_difference(<span class="string">'Article.count'</span>) <span class="keyword">do</span></span><br><span class="line">    post <span class="symbol">:create</span>, <span class="symbol">article:</span> &#123;<span class="symbol">title:</span> <span class="string">'Some title'</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">  assert_redirected_to article_path(assigns(<span class="symbol">:article</span>))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">test <span class="string">"new should render correct layout"</span> <span class="keyword">do</span></span><br><span class="line">  get <span class="symbol">:new</span></span><br><span class="line">  assert_template <span class="symbol">layout:</span> <span class="string">"layouts/application"</span>, <span class="symbol">partial:</span> <span class="string">"_form"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">setup <span class="keyword">do</span></span><br><span class="line">   <span class="variable">@product</span> = products(<span class="symbol">:one</span>)</span><br><span class="line">   <span class="variable">@update</span> = &#123;</span><br><span class="line">     <span class="symbol">title:</span> <span class="string">"toy bear"</span>,</span><br><span class="line">     <span class="symbol">description:</span> <span class="string">"a funny and elegant bear!"</span>,</span><br><span class="line">     <span class="symbol">image_url:</span> <span class="string">"1.jpg"</span>,</span><br><span class="line">     <span class="symbol">price:</span> <span class="number">14.8</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment"># è¿™é‡Œçš„update instance variableå¹¶ä¸æ˜¯ä¸€ä¸ªproduct object, è€Œæ˜¯ä¸€äº›æ¡ä»¶ï¼Œ ä¸ºäº†é¿å…ä¸‹é¢å‡ºç°é‡å¤æˆ‘ä»¬æå‰å£°æ˜ï¼›</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªsetupå‡½æ•°ä¼šåœ¨å…¶ä»–æ¯ä¸€ä¸ªsingle testå‰é¢æ‰§è¡Œï¼›ä¸ä¹‹é…å¥—çš„è¿˜æœ‰def teardown åœ¨æ¯ä¸€ä¸ªtestç»“æŸåæ‰§è¡Œ</p>
<p>6\<br>åœ¨test/modelé‡Œé¢æˆ‘ä»¬ä¸»è¦æ˜¯å¯¹databaseé‡Œé¢çš„dataæ£€æŸ¥ï¼Œ çœ‹çœ‹æœ‰æ²¡æœ‰å’ŒvalidatesçŸ›ç›¾ï¼›<br>åœ¨test/controlleréƒ¨åˆ†å°±æ˜¯å…³äºå’Œæ¯ä¸€ä¸ªactionæ˜¯å¦æˆåŠŸæ‰§è¡Œå’Œå‘é€httpè¯·æ±‚ï¼›<br>åœ¨test/fixtureéƒ¨åˆ†æ³¨æ„ä¸èƒ½ä½¿ç”¨tabï¼Œ åªå¯ä»¥ç”¨space; testé‡Œé¢ä½¿ç”¨çš„ä½¿ç”¨ï¼Œ æˆ‘ä»¬ä¸ä»…ä»…å¯ä»¥ç”¨findæ¥ä»æ•°æ®åº“ä¸­æ‰¾åˆ°fixtureé‡Œçš„ä¾‹å­ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥<br>ä½¿ç”¨railsåˆ›å»ºçš„æ·å¾„ï¼š</p>
<p>person = Person(:one) å¯ä»¥èµ‹å€¼åˆ°ç¬¬ä¸€ä¸ªåå­—ä¸ºoneçš„å›ºä»¶ï¼›</p>
<p>7\åœ¨routes.rbé‡Œé¢å‡ºç°çš„ä¸€äº›æ³¨æ„ç‚¹ï¼š<br>  resources :products</p>
<h1 id="å°†httpçš„è¯·æ±‚åŠ¨ä½œè‡ªåŠ¨è½¬æ¢ä¸ºcontrolleré‡Œç›¸åº”çš„actions">å°†httpçš„è¯·æ±‚åŠ¨ä½œè‡ªåŠ¨è½¬æ¢ä¸ºcontrolleré‡Œç›¸åº”çš„actions</h1><p>  root â€œstore#indexâ€, as: â€œstoreâ€</p>
<p>#åé¢çš„è¿™ä¸ªas: â€œâ€ åªæ˜¯ä¸ºäº†åœ¨ä½¿ç”¨store_pathçš„æ—¶å€™çš„ä¸€ä¸ªç®€åŒ–å¼•ç”¨è€Œå·²ï¼Œ å°±åƒä¹‹å‰çš„say_goodbye_pathçš„ç”¨æ³• </p>
<p>8\<br>erbæ’ä»¶ï¼š command+shift+. å¯ä»¥æ‰“å¼€erbçš„æ ¼å¼<br>AdvanceNewFileæ’ä»¶ï¼š option+command+n åœ¨ä¸‹é¢çš„pathå¤„è¾“å…¥ :project.erb åˆ™åœ¨å½“å‰è·¯å¾„åŠ ä¸Šè¿™ä¸ªfileï¼›<br>å¿«æ·é”®ï¼š command+shift+d å¯ä»¥å¤åˆ¶å½“å‰è¡Œ<br>docDashæ’ä»¶ï¼š control+hå¯ä»¥æ‰“å¼€dashæµè§ˆå™¨çœ‹doc</p>
<p>9\cssæŠ€å·§ï¼šæ¥è‡ªã€Šè§†å·®çš„web designã€‹ï¼ <a href="http://line25.com/tutorials/create-a-cool-website-with-fancy-scrolling-effects" target="_blank" rel="external">http://line25.com/tutorials/create-a-cool-website-with-fancy-scrolling-effects</a><br>text-indent é€šè¿‡text-indent: -9999pxï¼Œ ä½¿å¾—æ–‡å­—å¯ä»¥éšè—ï¼Œ åªæ˜¾ç¤ºimageï¼Œ åŒæ—¶ä¹Ÿæœ‰å¯¹åº”çš„æ ‡ç­¾ï¼Œ seoä¹Ÿå®ç°ï¼› å¯¹äºæ¯ä¸€ä¸ªblockï¼Œ textä¼šè¢«ç§»å¼€ï¼Œ<br>ç”¨æˆ·åªèƒ½çœ‹åˆ°background-imageï¼Œ æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æŠ€å·§ï¼›</p>
<p>background-size: cover ä½¿å¾—å›¾ç‰‡å¯ä»¥è‡ªé€‚åº”ç”¨æˆ·çš„å°ºå¯¸</p>
<p>transform: rotate(10deg);<br>z-index: 3; å¯ä»¥è®²å¯¹åº”çš„blockç›¸åº”çš„æ—‹è½¬ï¼Œ è®¾ç½®ç›¸å¯¹å‰åï¼› é…åˆ li:nth-child(3){} åœ¨å¤šä¸ªlié‡Œé¢é€‰æ‹©éœ€è¦çš„</p>
<p>åˆå§‹çš„æ¡ä»¶æ˜¯ä¸€ä¸ªåŸºç¡€çš„vertical designï¼Œ ä¹Ÿå°±æ˜¯åƒå¹»ç¯ç‰‡ä¸€æ ·çš„é€šè¿‡å‡ ä¸ªä¸åŒçš„sectionæ„å»ºèµ·æ¥çš„ã€‚åŸºç¡€ç»“æ„ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">section</span>&gt;</span></span><br><span class="line">			...</span><br><span class="line">		<span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">section</span>&gt;</span></span><br><span class="line">			...</span><br><span class="line">		<span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">ç„¶ååœ¨æ¯ä¸€ä¸ªsectioné‡Œé¢ï¼Œ ä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå•ç‹¬çš„é¡µé¢ï¼Œ å¯ä»¥å†è®¾è®¡å„ç§é¡µé¢çš„ç»“æ„ï¼šé€šè¿‡åœ¨cssé‡Œé¢è®¾è®¡section&#123;height: 992px;&#125;æ¥æ’‘å¼€é¡µé¢ï¼›</span><br><span class="line"><span class="tag">&lt;<span class="title">section</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">h1</span>&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">img</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line"><span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>10\ å¦‚ä½•è®¾å®šmodelä¹‹é—´çš„å…³ç³»<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate scaffold LineItem <span class="string">product:</span>references <span class="string">cart:</span>belongs_to</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateLineItems</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Migration</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></span><br><span class="line">    create_table <span class="symbol">:line_items</span> <span class="keyword">do</span> |t|</span><br><span class="line">      t.references <span class="symbol">:product</span>, <span class="symbol">index:</span> <span class="keyword">true</span>, <span class="symbol">foreign_key:</span> <span class="keyword">true</span></span><br><span class="line">      <span class="comment"># è¿™ä¸€è¡Œçš„ä½œç”¨æ˜¯åœ¨line_itemsé‡Œé¢å¢åŠ ä¸€è¡Œinteger columnï¼š product_id;</span></span><br><span class="line">      t.belongs_to <span class="symbol">:cart</span>, <span class="symbol">index:</span> <span class="keyword">true</span>, <span class="symbol">foreign_key:</span> <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">      t.timestamps <span class="symbol">null:</span> <span class="keyword">false</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>===</p>
<h1 id="å®˜æ–¹æ–‡æ¡£é‡Œé¢å¯¹_has_many_:through_çš„å®šä¹‰">å®˜æ–¹æ–‡æ¡£é‡Œé¢å¯¹ has_many :through çš„å®šä¹‰</h1><p>å°±æ˜¯åœ¨many_to_manyé‡Œé¢æ‰¾åˆ°ä¸€ä¸ªæ¡¥æ¢ï¼Œ é‚£ä¸ªæ¡¥æ¢æ˜¯ä¸€ä¸ªpair<br>The has_many :through Association<br>A has_many :through association is often used to set up a many-to-many<br>connection with another model. This association indicates that the declaring<br>model can be matched with zero or more instances of another model by proceeding<br>through a third model. For example, consider a medical practice where patients<br>make appointments to see physicians. The relevant association declarations could look like this:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Physician</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_many <span class="symbol">:appointments</span></span><br><span class="line">  has_many <span class="symbol">:patients</span>, <span class="symbol">:through</span> =&gt; <span class="symbol">:appointments</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Appointment</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  belongs_to <span class="symbol">:physician</span></span><br><span class="line">  belongs_to <span class="symbol">:patient</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Patient</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_many <span class="symbol">:appointments</span></span><br><span class="line">  has_many <span class="symbol">:physicians</span>, <span class="symbol">:through</span> =&gt; <span class="symbol">:appointments</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨ has_and_belongs_to_manyçš„è¯ï¼Œ å°±æ˜¯ç›´æ¥è®¾å®šmany_to_manyçš„è®¾å®šï¼Œ è€Œä¸ç»è¿‡å¦å¤–ä¸€ä¸ªmodel;<br>The simplest rule of thumb is that you should set up a has_many :through relationship if<br>you need to work with the relationship model as an independent entity. If you donâ€™t need<br>to do anything with the relationship model, it may be simpler to set up a has_and_belongs_to_many<br> relationship (though youâ€™ll need to remember to create the joining table in the database).</p>
<p>You should use has_many :through if you need validations, callbacks, or extra attributes on the join model.</p>
<p>11\ :referencesçš„ä½¿ç”¨<br>åœ¨åˆ›å»ºmodelçš„æ—¶å€™ï¼Œ åœ¨commentè¿™ä¸ªmodelé‡Œé¢æ·»åŠ ä¸€ä¸ªå·²æœ‰modelçš„field, ä¸º post_id, å› æ­¤æˆ‘ä»¬è¿™ä¹ˆåšï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rails generate scaffold Post <span class="string">name:</span>string <span class="string">title:</span>string <span class="string">content:</span>text</span><br><span class="line"></span><br><span class="line">rails generate model Comment <span class="string">author:</span>string <span class="string">body:</span>text <span class="string">post:</span>references </span><br><span class="line"></span><br><span class="line">rake <span class="string">db:</span>migrate</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±å¾—åˆ°çš„modelæ˜¯ï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">	belongs_to <span class="symbol">:post</span></span><br><span class="line">	attr_accessible <span class="symbol">:author</span>, <span class="symbol">:body</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>12\ å¢åŠ ä¸€ä¸ªLineItemçš„model<br>rails generate scaffold LineItem product:references cart:belongs_to<br>é‡ç‚¹åœ¨äº :references å’Œ :belongs_to çš„åŒºåˆ«ï¼Œ æ‰€ä»¥å…¶å®æ˜¯ä¸€è‡´çš„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œ è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œ ä»¤LineItem belongs_to<br>product å’Œ cart è¿™ä¸¤ä¸ªmodel; è€Œå®ƒè¿™é‡Œå¸Œæœ›å–å¾—çš„æ•ˆæœå°±æ˜¯è¾¾åˆ°many_to_manyçš„ç›®çš„ï¼›physicians å’Œ patients ä¹‹é—´æ˜¯<br>many_to_manyçš„å…³ç³»ï¼Œ ç„¶åé€šè¿‡ LineItem è¿™ä¸ªä¸­é—´ä»‹è´¨æ¥è¾¾åˆ°ç›®çš„ï¼›</p>
<p>åŒæ ·ï¼Œ æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™ä½¿ç”¨belongs_to, å½“ä¸€ä¸ªtableå…·æœ‰foreign_keyçš„æ—¶å€™ï¼Œ éœ€è¦ç”¨è¿™ä¸ªæ¥å£°æ˜å’Œé‚£ä¸ªmodelä¹‹é—´çš„å…³ç³»ï¼›</p>
<p>13\ ä½¿ç”¨ add_to_cart buttonçš„ä½œç”¨<br>åœ¨è¿™ä¹‹å‰ï¼Œ link_to è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ˜¯httpçš„getåŠŸèƒ½ï¼›ç„¶ååœ¨è¿™ä¸ªåœ°æ–¹ï¼Œ åœ¨æˆ‘ä»¬ç‚¹å‡»add to cartçš„æ—¶å€™ï¼Œ æˆ‘ä»¬å¸Œæœ›åšåˆ°çš„æ˜¯å»åˆ›å»ºä¸€ä¸ª<br>lineitemçš„obeject, ä½¿ç”¨çš„æ˜¯httpçš„poståŠŸèƒ½. ä¹‹å‰ä½¿ç”¨poståŠŸèƒ½çš„åœ°æ–¹æ˜¯sumbitæŒ‰é’®ï¼Œ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨button_to;</p>
<p>@@é‡ç‚¹ï¼Œ åœ¨link_to å’Œ button_toçš„æƒ…å†µä¸‹ï¼Œ å› ä¸ºæµè§ˆå™¨å·²ç»çŸ¥é“ä»–ä»¬è°ƒç”¨çš„æ˜¯httpçš„ä»€ä¹ˆæ–¹æ³•ï¼Œ å› æ­¤æˆ‘ä»¬åªéœ€è¦å°†ä»–ä»¬å¯¼æµåˆ°å¯¹åº”controller<br>çš„ä½ç½®å°±å¯ä»¥äº†ï¼›railsä¼šæ ¹æ®httpçš„åŠ¨ä½œè°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œ ç„¶åç”¨ä¸€ä¸‹shortcut path, ä¹Ÿå°±æ˜¯ line_item_path;<br>ä¸ºäº†åˆ›å»ºä¸€ä¸ªLineItem obejectï¼Œ æˆ‘ä»¬éœ€è¦product_idå’Œcart_idï¼Œ cart_idå¯ä»¥åœ¨sessionä¸­å¾—åˆ°ï¼Œ product_idåˆ™éœ€è¦ç”¨å‚æ•°ä¼ å…¥ï¼›</p>
<p>&lt;%= button_to â€˜Add to Cartâ€™, line_item_path(product_id: product) % &gt;</p>
<p>è¿™ä¸ªæ“ä½œåˆ›å»º<form></form></p>
<p>14\ åœ¨åˆ›å»ºmodelä¹‹åï¼Œ æ›´æ–°modelï¼Œ æ·»åŠ æˆ–è€…åˆ é™¤columns;<br>ç›®çš„ï¼š å¯¹äºä¹‹å‰åˆ›å»ºçš„line_items model, å¢åŠ ä¸€ä¸ªcolumn<br>rails generate migration add_quantity_to_line_items quantity:integer<br>ä½¿ç”¨add)add_quantity_to_line_items\ remove_quantity_to_line_itemsæ¥å¢åŠ æˆ–è€…åˆ é™¤column;</p>
<p>15\ å¦‚æœè®©seperate multiple rows collapseï¼Œ å†æ¬¡å¯¹dbæ”¹å˜<br>rails generate migration combine_items_in_cart<br>è¿™ä¸€æ¬¡æˆ‘ä»¬å¹¶æ²¡æœ‰è¯´æ˜éœ€è¦æ·»åŠ æˆ–è€…åˆ é™¤å“ªä¸€ä¸ªcolumnï¼Œ äºæ˜¯æˆ‘ä»¬ä¸ç”¨def changeï¼Œ æˆ‘ä»¬å®šä¹‰up and down å‡½æ•°ï¼›</p>
<p>sums = cart.line_items.group(:product_id).sum(:quantity)<br>å¾—åˆ°çš„æ˜¯ï¼Œ å¯¹äºåŒä¸€ä¸ªcarté‡ŒåŒä¸€ä¸ªproduct_idçš„æ•°é‡çš„æ€»å’Œï¼Œ ä¹Ÿå°±æ˜¯éƒ¨åˆ†ä¹‹å‰çš„seperateçš„è¿˜æ˜¯ï¼Œ ä¹‹åæ·»åŠ çš„ï¼›</p>
<p>é‡ç‚¹æ˜¯ï¼š groupä¹‹åå¾—åˆ°çš„æ•°æ®ç»“æ„ï¼Ÿä¸€ä¸ªnested array è¿˜æ˜¯ hash? å¾—åˆ°hashï¼›</p>
<p>æ³¨æ„ï¼š<br>cart.line_items.group(:product_id).count<br>cart.line_items.group(:product_id).sum(:quantity)<br>è¿™ä¸¤è€…çš„åŒºåˆ«ï¼› countåœ¨arrayä¸Šè°ƒç”¨çš„æ—¶å€™è¿”å›array.size; åœ¨è¿™é‡Œæ˜¯å¯¹æ¯ä¸€ä¸ªvalueçš„arrayè°ƒç”¨ï¼š<br>{â€˜product_id_1â€™ =&gt; 4, â€˜product_id_2â€™ =&gt; 3} æ•°å­—æ˜¯æ‹¥æœ‰ç›¸åŒproduct_idçš„ line_itemçš„æ•°ç›®<br>åè€…ç±»ä¼¼ï¼Œ å¾—åˆ°ç±»ä¼¼çš„ç»“æ„ï¼Œ ä¸è¿‡ï¼Œ æ•°å­—è¡¨ç¤ºçš„æ˜¯ï¼Œ æ‹¥æœ‰ç›¸åŒproduct_idçš„ line_itemçš„productçš„æ•°ç›® ï¼›</p>
<p>16\ å®˜æ–¹å¯¹ array.inject çš„å®šä¹‰ï¼š<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inject(initial, sym) â†’ obj</span><br><span class="line">inject(sym) â†’ obj</span><br><span class="line">inject(initial) &#123; |<span class="string">memo, obj</span>|<span class="string"> block &#125; â†’ obj</span><br><span class="line">inject &#123; </span>|<span class="string">memo, obj</span>|<span class="string"> block &#125; â†’ obj</span></span><br></pre></td></tr></table></figure></p>
<p>Combines all elements of enum by applying a binary operation, specified by a block or a symbol that names a method or operator.</p>
<p>If you specify a block, then for each element in enum the block is passed an accumulator value (memo) and the element. If you specify a symbol instead, then each element in the collection will be passed to the named method of memo. In either case, the result becomes the new value for memo. At the end of the iteration, the final value of memo is the return value for the method.</p>
<p>If you do not explicitly specify an initial value for memo, then the first element of collection is used as the initial value of memo.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Sum some numbers</span></span><br><span class="line">(<span class="number">5.</span><span class="number">.10</span>).reduce(:+)                             <span class="preprocessor">#=&gt; <span class="number">45</span></span></span><br><span class="line"><span class="preprocessor"># Same using a block and inject</span></span><br><span class="line">(<span class="number">5.</span><span class="number">.10</span>).inject &#123; |sum, n| sum + n &#125;            <span class="preprocessor">#=&gt; <span class="number">45</span></span></span><br><span class="line"><span class="preprocessor"># Multiply some numbers</span></span><br><span class="line">(<span class="number">5.</span><span class="number">.10</span>).reduce(<span class="number">1</span>, :*)                          <span class="preprocessor">#=&gt; <span class="number">151200</span></span></span><br><span class="line"><span class="preprocessor"># Same using a block</span></span><br><span class="line">(<span class="number">5.</span><span class="number">.10</span>).inject(<span class="number">1</span>) &#123; |product, n| product * n &#125; <span class="preprocessor">#=&gt; <span class="number">151200</span></span></span><br><span class="line"><span class="preprocessor"># find the longest word</span></span><br><span class="line">longest = %w&#123; cat sheep bear &#125;.inject <span class="keyword">do</span> |memo, word|</span><br><span class="line">   memo.length &gt; word.length ? memo : word</span><br><span class="line">end</span><br><span class="line">longest                                        <span class="preprocessor">#=&gt; <span class="string">"sheep"</span></span></span><br></pre></td></tr></table></figure>
<p>åº”ç”¨ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">what I have</span><br><span class="line"></span><br><span class="line">hash = &#123;:a=&gt;<span class="number">5</span>, :b=&gt;<span class="number">10</span>, :c=&gt;<span class="number">15</span>, :d=&gt;<span class="number">3</span>&#125;</span><br><span class="line">The result that I want</span><br><span class="line"></span><br><span class="line">&#123;:a=&gt;<span class="number">5</span>, :b=&gt;<span class="number">15</span>, :c=&gt;<span class="number">30</span>, :d=&gt;<span class="number">33</span>&#125;</span><br><span class="line"></span><br><span class="line">è§£ç­”ï¼š</span><br><span class="line"></span><br><span class="line">hash.inject(<span class="number">0</span>) &#123; |s, (k, v)| hash[k] = s + v &#125;</span><br><span class="line"><span class="preprocessor"># =&gt; <span class="number">33</span></span></span><br><span class="line">hash</span><br><span class="line"><span class="preprocessor"># =&gt; &#123;:a=&gt;<span class="number">5</span>, :b=&gt;<span class="number">15</span>, :c=&gt;<span class="number">30</span>, :d=&gt;<span class="number">33</span>&#125; </span></span><br><span class="line">If you want to preserve the original hash, you can use each_with_object instead:</span><br><span class="line"></span><br><span class="line">hash.each_with_object(&#123;&#125;) &#123; |(k, v), h| h[k] = v + (h.values.last||<span class="number">0</span>)  &#125;</span><br><span class="line"><span class="preprocessor"># =&gt; &#123;:a=&gt;<span class="number">5</span>, :b=&gt;<span class="number">15</span>, :c=&gt;<span class="number">30</span>, :d=&gt;<span class="number">33</span>&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>17\ å®˜æ–¹å¯¹ where çš„å®šä¹‰ï¼š</p>
<p>where(opts = :chain, *rest)<br>Returns a new relation, which is the result of filtering the current relation according to the conditions in the arguments.</p>
<p>where accepts conditions in one of several formats. In the examples below, the resulting SQL is given as an illustration; the actual query generated may be different depending on the database adapter.</p>
<p>string</p>
<p>A single string, without additional arguments, is passed to the query constructor as an SQL fragment, and used in the where clause of the query.</p>
<p>Client.where(â€œorders_count = â€˜2â€™â€)</p>
<h1 id="SELECT_*_from_clients_where_orders_count_=_â€˜2â€™;">SELECT * from clients where orders_count = â€˜2â€™;</h1><p>Note that building your own string from user input may expose your application to injection attacks if not done properly. As an alternative, it is recommended to use one of the following methods.</p>
<p>array</p>
<p>If an array is passed, then the first element of the array is treated as a template, and the remaining elements are inserted into the template to generate the condition. Active Record takes care of building the query to avoid injection attacks, and will convert from the ruby type to the database type where needed. Elements are inserted into the string in the order in which they appear.</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span>.where([<span class="string">"name = ? and email = ?"</span>, <span class="string">"Joe"</span>, <span class="string">"joe@example.com"</span>])</span><br><span class="line"><span class="comment"># SELECT * FROM users WHERE name = 'Joe' AND email = 'joe@example.com';</span></span><br><span class="line"><span class="type">Alternatively</span>, you can use named placeholders <span class="keyword">in</span> the <span class="keyword">template</span>, <span class="keyword">and</span> pass a hash <span class="keyword">as</span> the second element <span class="keyword">of</span> the <span class="type">array</span>. <span class="type">The</span> names <span class="keyword">in</span> the <span class="keyword">template</span> are replaced <span class="keyword">with</span> the corresponding values <span class="keyword">from</span> the hash.</span><br><span class="line"></span><br><span class="line"><span class="type">User</span>.where([<span class="string">"name = :name and email = :email"</span>, &#123; name: <span class="string">"Joe"</span>, email: <span class="string">"joe@example.com"</span> &#125;])</span><br><span class="line"><span class="comment"># SELECT * FROM users WHERE name = 'Joe' AND email = 'joe@example.com';</span></span><br><span class="line"><span class="type">This</span> can make <span class="keyword">for</span> more readable code <span class="keyword">in</span> complex queries.</span><br><span class="line"></span><br><span class="line"><span class="type">Lastly</span>, you can use sprintf-style % escapes <span class="keyword">in</span> the <span class="keyword">template</span>. <span class="type">This</span> works slightly differently than the previous methods; you are responsible <span class="keyword">for</span> ensuring that the values <span class="keyword">in</span> the <span class="keyword">template</span> are properly quoted. <span class="type">The</span> values are passed to the connector <span class="keyword">for</span> quoting, but the caller <span class="keyword">is</span> responsible <span class="keyword">for</span> ensuring they are enclosed <span class="keyword">in</span> quotes <span class="keyword">in</span> the resulting <span class="type">SQL</span>. <span class="type">After</span> quoting, the values are inserted <span class="keyword">using</span> the same escapes <span class="keyword">as</span> the <span class="type">Ruby</span> core <span class="keyword">method</span> <span class="type">Kernel</span>::sprintf.</span><br><span class="line"></span><br><span class="line"><span class="type">User</span>.where([<span class="string">"name = '%s' and email = '%s'"</span>, <span class="string">"Joe"</span>, <span class="string">"joe@example.com"</span>])</span><br><span class="line"><span class="comment"># SELECT * FROM users WHERE name = 'Joe' AND email = 'joe@example.com';</span></span><br><span class="line"><span class="type">If</span> where <span class="keyword">is</span> called <span class="keyword">with</span> multiple arguments, these are treated <span class="keyword">as</span> <span class="keyword">if</span> they were passed <span class="keyword">as</span> the elements <span class="keyword">of</span> a single <span class="type">array</span>.</span><br><span class="line"></span><br><span class="line"><span class="type">User</span>.where(<span class="string">"name = :name and email = :email"</span>, &#123; name: <span class="string">"Joe"</span>, email: <span class="string">"joe@example.com"</span> &#125;)</span><br><span class="line"><span class="comment"># SELECT * FROM users WHERE name = 'Joe' AND email = 'joe@example.com';</span></span><br><span class="line"><span class="type">When</span> <span class="keyword">using</span> strings to specify conditions, you can use <span class="type">any</span> operator available <span class="keyword">from</span> the database. <span class="type">While</span> this provides the most flexibility, you can also unintentionally introduce dependencies on the underlying database. <span class="type">If</span> your code <span class="keyword">is</span> intended <span class="keyword">for</span> general consumption, test <span class="keyword">with</span> multiple database backends.</span><br></pre></td></tr></table></figure>
<p>hash</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">where will also accept a hash condition, in which the keys are fields and the values are values to be searched for.</span><br><span class="line"></span><br><span class="line">Fields can be symbols or strings. Values can be single values, arrays, or ranges.</span><br><span class="line"></span><br><span class="line">User.where(&#123; name: "Joe", email: "joe@example.com" &#125;)</span><br><span class="line"># <span class="operator">SELECT * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Joe'</span> <span class="keyword">AND</span> email = <span class="string">'joe@example.com'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">User</span>.<span class="keyword">where</span>(&#123; <span class="keyword">name</span>: [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>]&#125;)</span><br><span class="line"># SELECT * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">IN</span> (<span class="string">'Alice'</span>, <span class="string">'Bob'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">User</span>.<span class="keyword">where</span>(&#123; created_at: (<span class="keyword">Time</span>.<span class="keyword">now</span>.midnight - <span class="number">1.</span><span class="keyword">day</span>)..<span class="keyword">Time</span>.<span class="keyword">now</span>.midnight &#125;)</span><br><span class="line"># SELECT * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> (created_at <span class="keyword">BETWEEN</span> <span class="string">'2012-06-09 07:00:00.000000'</span> <span class="keyword">AND</span> <span class="string">'2012-06-10 07:00:00.000000'</span>)</span><br><span class="line"><span class="keyword">In</span> the <span class="keyword">case</span> <span class="keyword">of</span> a belongs_to relationship, an association <span class="keyword">key</span> can be used <span class="keyword">to</span> specify the <span class="keyword">model</span> <span class="keyword">if</span> an ActiveRecord <span class="keyword">object</span> <span class="keyword">is</span> used <span class="keyword">as</span> the <span class="keyword">value</span>.</span><br><span class="line"></span><br><span class="line">author = Author.find(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"># The <span class="keyword">following</span> queries will be equivalent:</span><br><span class="line">Post.<span class="keyword">where</span>(author: author)</span><br><span class="line">Post.<span class="keyword">where</span>(author_id: author)</span><br><span class="line">This also works <span class="keyword">with</span> polymorphic belongs_to relationships:</span><br><span class="line"></span><br><span class="line">treasure = Treasure.<span class="keyword">create</span>(<span class="keyword">name</span>: <span class="string">'gold coins'</span>)</span><br><span class="line">treasure.price_estimates &lt;&lt; PriceEstimate.<span class="keyword">create</span>(price: <span class="number">125</span>)</span><br><span class="line"></span><br><span class="line"># The <span class="keyword">following</span> queries will be equivalent:</span><br><span class="line">PriceEstimate.<span class="keyword">where</span>(estimate_of: treasure)</span><br><span class="line">PriceEstimate.<span class="keyword">where</span>(estimate_of_type: <span class="string">'Treasure'</span>, estimate_of_id: treasure)</span><br><span class="line">Joins</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> the relation <span class="keyword">is</span> the <span class="keyword">result</span> <span class="keyword">of</span> a <span class="keyword">join</span>, you may <span class="keyword">create</span> a condition which uses <span class="keyword">any</span> <span class="keyword">of</span> the <span class="keyword">tables</span> <span class="keyword">in</span> the <span class="keyword">join</span>. <span class="keyword">For</span> <span class="keyword">string</span> <span class="keyword">and</span> <span class="built_in">array</span> conditions, <span class="keyword">use</span> the <span class="keyword">table</span> <span class="keyword">name</span> <span class="keyword">in</span> the condition.</span><br><span class="line"></span><br><span class="line"><span class="keyword">User</span>.joins(:posts).<span class="keyword">where</span>(<span class="string">"posts.created_at &lt; ?"</span>, <span class="keyword">Time</span>.<span class="keyword">now</span>)</span><br><span class="line"><span class="keyword">For</span> <span class="keyword">hash</span> conditions, you can either <span class="keyword">use</span> the <span class="keyword">table</span> <span class="keyword">name</span> <span class="keyword">in</span> the <span class="keyword">key</span>, <span class="keyword">or</span> <span class="keyword">use</span> a sub-<span class="keyword">hash</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">User</span>.joins(:posts).<span class="keyword">where</span>(&#123; <span class="string">"posts.published"</span> =&gt; <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="keyword">User</span>.joins(:posts).<span class="keyword">where</span>(&#123; posts: &#123; published: <span class="literal">true</span> &#125; &#125;)</span><br><span class="line"><span class="keyword">no</span> argument</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> <span class="keyword">no</span> argument <span class="keyword">is</span> passed, <span class="keyword">where</span> <span class="keyword">returns</span> a <span class="keyword">new</span> <span class="keyword">instance</span> <span class="keyword">of</span> WhereChain, that can be chained <span class="keyword">with</span> <span class="keyword">not</span> <span class="keyword">to</span> <span class="keyword">return</span> a <span class="keyword">new</span> relation that negates the <span class="keyword">where</span> clause.</span><br><span class="line"></span><br><span class="line"><span class="keyword">User</span>.<span class="keyword">where</span>.<span class="keyword">not</span>(<span class="keyword">name</span>: <span class="string">"Jon"</span>)</span><br><span class="line"># SELECT * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> != <span class="string">'Jon'</span></span><br><span class="line">See WhereChain <span class="keyword">for</span> more details <span class="keyword">on</span> <span class="keyword">not</span>.</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/12/24/ç”¨reveal-jsåˆ¶ä½œç”Ÿæ—¥æ´¾å¯¹ç¤¼ç‰©/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">ç”¨reveal.jsåˆ¶ä½œç”Ÿæ—¥ç¤¼ç‰©</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">åˆ†äº«åˆ°: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- å¤šè¯´è¯„è®ºæ¡† start -->
	<div class="ds-thread" data-thread-key="agile-web-developing-in-rails-ç¬¬ä¸€æœŸ" data-title="Agile web developing in rails ç¬¬ä¸€æœŸ" data-url="http://yoursite.com/2015/12/24/agile-web-developing-in-rails-ç¬¬ä¸€æœŸ/"></div>
	<!-- å¤šè¯´è¯„è®ºæ¡† end -->
	<!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Shunzhe Yu
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41207871-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>